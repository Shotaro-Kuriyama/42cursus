## lsblk構成の意味

全体像（ディスク → パーティション → 暗号化 → LVM → マウント先）

1. 物理ディスク
・sda : 12GB の仮想ディスク

2. パーティション
・sda1 : 791MB → /boot
・sda2 : 1KB → これは **拡張パーティション(extended)の“入れ物”**みたいな扱い（MBR構成でよく出る表示）
・sda5 : 11.2GB → 実データ領域（この中が暗号化）

3. 暗号化（LUKS）
・sda5_crypt : sda5 を 暗号化解除して開いたデバイス
・つまり「鍵を開けた状態の中身」がこれ

4. LVM（ボリュームグループと論理ボリューム）
skuriyam42--vg というVGの中に、LVが3つ：
・skuriyam42--vg-root : 7.1GB → /
・skuriyam42--vg-home : 3.5GB → /home
・skuriyam42--vg-swap_1 : 624MB → swap

PV (Physical Volume): 実際のハードディスク（/dev/sdaなど）
やそのパーティション（/dev/sda1など）のこと。



##　ディスク （sda）とは？

例えばimacに搭載されているhddやssd（ハードディスク）のうち、12GBの容量を仮想ディスクとしてこの仮想マシンに割り当てるということ。

・VirtualBoxのVMに「12GBの仮想ディスク」を割り当てる
・Debianから見ると、それは 本物のHDD/SSDみたいに見える1台のディスク
・そのデバイス名が sda（昔からの慣習で “SCSI/SATA系ディスクの1台目”）
つまり 「VMに渡した12GBの箱」＝/dev/sda。


## パーティション（sda1, sda5）とは？

sdaを分割しているということ。

・1つのディスク（箱）を 用途ごとに区切るのがパーティション
・sda1 は「起動用 /boot」に使う
・sda5 は「OS本体やhomeなど、残り全部」に使う

今の構成は：
・sda1 → /boot（小さめ、起動に必要なものだけ）
・sda5 → それ以外（ここを暗号化してからLVMに渡してる）


## 暗号化（sda5_crypt）って何？

結論から言うと：
暗号化 = “ディスクの中身を、鍵がないと読めない文字列に変換して保存する仕組み”
（ファイルを暗号化するのではなく、この場合は パーティション丸ごと 暗号化）

何が嬉しいの？

もし誰かがあなたの仮想ディスク（.vdi ファイル）をコピーしても、
・鍵（パスフレーズ）が無ければ
・ディスクの中身（ファイル、設定、ログ、パスワード関連の情報）を
・直接読めない
つまり 「ディスクを盗まれても中身を守れる」 っていう強力なセキュリティ。

sda5 と sda5_crypt の関係（超重要）

あなたの lsblk でこうなってた：
・sda5（11.2G）
・sda5_crypt（crypt）

これの意味は：
・sda5：暗号化された“箱”（中身はぐちゃぐちゃの暗号データ）
・sda5_crypt：起動時にパスフレーズを入力して、箱を開けた結果できる「開いたデバイス」

イメージで言うと：
・sda5 = 鍵付き金庫（中身は見えない）
・sda5_crypt = 鍵を開けて中身を取り出せる状態の金庫

Linuxは「鍵を開けたあとの入口」を 別デバイスとして作る。それが *_crypt。

### じゃあ /boot はなんで暗号化しないの？

超大事ポイント。
起動の流れはざっくり：
1. PC（VM）が起動
2. まず /boot にあるカーネル・initramfsを読み込む
3. その後に暗号化領域を開ける（パスフレーズ入力）
4. ルート / をマウントして本格起動

つまり 暗号化を開けるために必要な部品（カーネル等）が /boot にあるから、
/boot 自体を暗号化すると「起動できなくなる」か「さらに複雑な仕組みが必要」になる。

だからBorn2beRootではよく
1. /bootは平文
2. それ以外は暗号化
   って構成が採用される

### 暗号化は「何を守ってる」の？

あなたの構成だと、暗号化の内側にあるのは：

・/（OS・設定・ログ等）
・/home（ユーザーのデータ）
・swap（メモリ退避で機密が漏れうる）

なので 実質ほぼ全部が守られてる（/boot以外）。


## LVMとはなにか？


「LVMの存在理由」＝「パーティションの弱点を補う仕組み」 が理解できます。結論から言うと：
・パーティションは「ディスクを物理的に切り分ける“固定の壁”」
・LVMは「その上に作る“可変の区画整理（後から伸縮・移動できる壁）”」

なので、役割は似て見えるけど 目的が違うし、重複ではなく 二段構えなんです。


1) パーティションだけだと何が困る？

パーティションは一度切ると、あとでこういう問題が出ます：

例：/（OS）が足りなくなった
・/var/log が増えた
・aptで色々入れて / が満杯になった

でも「/ は sda5 の中のどこまで」みたいに固定していると、
・/ を増やしたい → 隣の領域が空いてないと増やせない
・空いてても、並び替えや移動が必要になって 作業が重い/怖い
要するに、パーティションは 融通が効かない。

2) LVMは何をしてくれる？

LVMの発想はこう：
「ディスク（やパーティション）を、まず大きな“プール”としてまとめる。
そのプールから、/ や /home などの“論理的な区画”を好きなサイズで切る。
しかも後からサイズ変更しやすい。」

あなたの構成で言うと：
・sda5_crypt（暗号化解除した1枚の大きな領域）
↓
・それを VG（Volume Group）= “容量プール” にする
↓
・そこから
	・LV root（/）
	・LV home（/home）
	・LV swap
	　を切り出している

3) じゃあ「重複」じゃないの？（核心）

重複に見えるけど、レイヤーが違う。

パーティションの役割（低レイヤー）
・「この領域は /boot 用」
・「この領域は暗号化用」
みたいに、ディスクを“土台レベル”で分ける。

特に /boot と “暗号化領域” を分けるのはパーティションが得意。
（起動の都合で /boot は平文にする必要があるから）

LVMの役割（上レイヤー）
その“暗号化解除後の領域”の中を、
・/ に何GB
・/home に何GB
・swap に何MB
みたいに 運用上の都合で柔軟に割り当てる。

つまり、
・パーティション：起動・暗号化・大枠の境界
・LVM：運用しやすいサイズ調整・構成変更



問1
sdaは何を表しているか？

解答
VMに割り当てた12GBの仮想ディスク（OSからは物理ディスクに見える）。

問2
sda1 が /boot にマウントされている理由を答えよ。

解答
まず、/bootディレクトリはカーネルやGRUB関連を保存する部分であり、sda1をsdaのパーティションとして
分割し、そこに/bootを置く、暗号化しないのは 暗号化を開けるために必要な部品（カーネル等）が /boot にある
からである。

問3
sda5 と sda5_crypt の違いを説明しなさい。
暗号化 = “ディスクの中身を、鍵がないと読めない文字列に変換して保存する仕組み”であり、
sda5が暗号化されているディスクで、sda5_cryptはパスワードを入力して開けたあとに現れる
中身が読めるディスクである。


問4
次の主張に反論してください。
「LVMが分割できるなら、最初から全部LVMにしてパーティション要らなくない？」

/boot は暗号化の外に置きたい（起動の都合）→ パーティションで確保が簡単である。
つまり、パーティションは「暗号化する領域/しない領域」など 土台の境界を作り、
LVMはそのうちの暗号化したものの内側を「柔軟に」分割配分することができる。

問5
あなたの lsblk に sda2 1K がある。これを見て「1Kしかないパーティション！？壊れてる？」と思った人に、何と説明するか答えよ。


MBR = Master Boot Record の略で、
ディスク（例：/dev/sda）の いちばん最初の場所（先頭 512バイト） にある
そこに
起動用の小さなプログラム（ブートコード）
パーティションの一覧（パーティションテーブル）
が入っている
という“形式（フォーマット）”のことです。
MBRには有名な制限が2つあります。
制限A：主パーティションが最大4つ
ディスクを区切る“枠”が4つまでしかない。
→ そこで出てくるのが 拡張パーティション（extended）
「4つのうち1つを“入れ物”にして、その中に論理パーティションをたくさん作る」
（あなたの sda2 がこれ）
制限B：2TB制限（古い環境で問題になりやすい）
MBRは大きいディスクに弱い（細かい理屈は今は置いてOK）

つまり、sda5は論理パーティションです。
ただ、パーティションが4つまでつくれるならわざわざ拡張パーティションを作る必要がないように思えるが

da1 = /boot（主）
sda2 = LUKS用（主）→ その中でLVM

でも、あなたの構成ではわざわざ

sda2 = 拡張（入れ物）
sda5 = 論理（中身）

これは多くの場合 Debianのインストーラ（特に「暗号化LVMのガイド」）が、
この形をデフォルトで作りがちだからです。

拡張を使うメリット（“今回は必須じゃないけど、作る理由”）
1) 将来、パーティションを増やしやすい

MBRでは主パーティション枠が最大4つ。
拡張を1つ作っておけば、その中に 論理パーティションをいくらでも増やせる（技術的には多数）ので、

後から /var 用に別パーティションを切りたい

何か追加で領域を分けたい

みたいなときに、主パーティション枠を気にせず増やせます。

2) “昔からよくある慣習”

MBR時代は「/bootは主、残りは拡張にまとめて論理で運用」が定番でした。
インストーラがその流儀を踏襲していることが多いです。


問8：swapの役割（ひっかけ）

次の文は○×どっち？

A. swapは「RAMが足りないときの保険」
B. swapがあるとPCは必ず速くなる
C. swapには機密情報が載る可能性がある
D. swapはディレクトリにマウントされる

解答

A○ / B×（遅い媒体なので使うと遅くなりやすい） / C○ / D×（[SWAP] として直接使う）


仕上げ：防御（口頭試問）シミュレーション
問題9：30秒で説明

評価者に30秒で説明してください：

「あなたのVMは、ディスク→パーティション→暗号化→LVM→マウントがどうなっている？」

解答（例）
「12GBの仮想ディスク /dev/sda を、起動用に sda1 を /boot として切り、残りの sda5 を暗号化して sda5_crypt として開けています。その中をLVMのVGにして、LVを / 用、/home 用、swap用に分けてそれぞれマウントしています。」










sudo chage -l (list) skuriyam

sudo chage -M 30 -m 2 -W 7 <ユーザー名>


